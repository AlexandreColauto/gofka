syntax = "proto3";

package broker;

import "broker/metadata.proto";
import "broker/broker.proto";

option go_package = "github.com/alexandrecolauto/gofka/proto/broker";

service ProducerService {
    rpc HandleSendMessage(SendMessageRequest) returns (SendMessageResponse);
    rpc HandleSendBatch(SendBatchRequest) returns (SendBatchResponse);
    rpc FetchMetadata(FetchMetadataRequest) returns (FetchMetadataResponse);
    rpc HandleCreateTopic(CreateTopicRequest) returns (CreateTopicResponse);
}

enum ACKLevel {
  ACK_LEVEL_UNKNOWN = 0;
  ACK_0 = 1;
  ACK_1 = 2;
  ACK_ALL = 3;
}

message FetchMetadataRequest {
    int64 last_index = 1;
}

message FetchMetadataResponse {
    bool success = 1;
    string error_msg = 2;
    broker.ClusterMetadata metadata = 3;
}

message SendBatchRequest {
    string topic = 1;
    int32 partition = 2;
    ACKLevel ack = 3;
    repeated broker.Message messages = 4;
}

message SendBatchResponse {
    bool success = 1;
    string error_msg = 2;
}

message SendMessageRequest {
    string topic = 1;
    string key = 2;
    string value = 3;
}

message SendMessageResponse {
    bool success = 1;
    string error_msg = 2;
}

message CreateTopicRequest {
    string topic = 1;
    int32 partition = 2;
    int32 replication = 3;
}

message CreateTopicResponse {
    bool success = 1;
    string error_msg = 2;
}
